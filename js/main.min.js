!function($){var o={init:function(){this.facebook.init(),this.nav.init(),this.ship.init()},opts:{date:"jan",fbresponse:null},facebook:{init:function(){var o=this;this.load(function(){FB.init(o.config)})},config:{appId:439670099504894,cookie:!0,status:!0,xfbml:!0,version:"v2.1"},load:function(o){if("function"!=typeof o)return void console.error("FB.load callback MUST be a function");var t,n=document.getElementsByTagName("script")[0];return document.getElementById("facebook-jssdk")?void console.warn("FBSDK already loaded"):(t=document.createElement("script"),t.id="facebook-jssdk",t.src="//connect.facebook.net/en_US/sdk.js",t.addEventListener("load",function(){o()},!1),void n.parentNode.insertBefore(t,n))},utils:{login:function(){var t=this;null===o.opts.fbresponse&&FB.login(function(){t.checkLoginState()},{scope:"public_profile"})},checkLoginState:function(){var o=this;FB.getLoginStatus(function(t){o.statusChangeCallback(t)})},getAcctInfo:function(o,t){var n={};return"function"!=typeof t?void console.warn("getAcctInfo callback needs to be a function"):void FB.api("/"+o,function(e){n.acct=e,FB.api("/"+o+"/picture",function(o){n.img=o.data,t(n)})})},statusChangeCallback:function(t){"connected"===t.status?this.getAcctInfo(t.authResponse.userID,function(t){o.opts.fbresponse=t,$(".fb-login").addClass("logged-in")}):$(".fb-login").removeClass("not_authorized"===t.status?"logged-in":"logged-in")}}},nav:{init:function(){this.hash(),this.events()},hash:function(){var o=window.location.hash,t,n;return o&&(t=o.replace("!",""),n=$(t),$(".visible-deck").removeClass("visible-deck"),n.addClass("visible-deck")),!1},events:function(){var o=this;window.addEventListener("hashchange",function(){o.hash()},!1)}},ship:{init:function(){this.occupants.init()},occupants:{init:function(){this.events()},post:function(o){var t=this;$.post("/app/occupy",o).done(function(){t.get(o)}).fail(function(o){console.error("[POST Failure] - app.ship.occupants.post();"),console.log(o)})},get:function(t){var n=this;$.get("/app/occupy",t).done(function(t){if("null"!==t){$(".occupants").empty(),t=JSON.parse(t);for(var e=0;e<t.length;e++){var i=t[e].fbuser;o.facebook.utils.getAcctInfo(i,n.constructors.occupant)}}}).fail(function(o){console.error("[GET Failure] - app.ship.occupants.get();"),console.log(o)})},constructors:{occupant:function(o){var t="<div id='occupant-"+o.acct.id+"' class='occupant'><div class='profile-pic'><img src='"+o.img.url+"' alt='"+o.acct.name+"' /></div><div class='profile-info'><span class='name'>"+o.acct.name+"</span><a href='https://www.facebook.com/"+o.acct.id+"' title='View profile' target='_blank'>View Profile</a></div></div>";$(".occupants").append(t)}},events:function(){var t=this;$(".room-container").on("click",function(){var n=$(this),e=n.data("room"),i=n.data("deck"),c={room:e,deck:i,date:o.opts.date},a="<div class='popup' title=''><div class='title'><span class='left' title='Deck: "+i+", Room: "+e+"'>L"+i+"-R"+e+"</span><span class='right close-popup' title='Close'>&times;</span></div><div class='occupants no-occupants'>No occupants</div><div class='signup'><a href='#' class='occupy' data-room='"+e+"' data-deck='"+i+"'>Occupy this room</a></div></div>";$(".popup").remove(),$(".active-room").removeClass("active-room"),n.addClass("active-room"),n.append(a),t.get(c),$(".popup").on("click",function(o){return!1}),$(".close-popup").on("click",function(){return $(".popup").remove(),$(".active-room").removeClass("active-room"),!1}),$(".occupy").on("click",function(){var n=$(this),e;return o.opts.fbresponse?(e={room:n.data("room"),deck:n.data("deck"),user:o.opts.fbresponse,date:o.opts.date},t.post(e)):t.auth(),!1})}),$("input[name=select-date]").on("change",function(){var t=$(this).val();o.opts.date=t}),$(".fb-login").on("click",function(t){t.preventDefault(),o.facebook.utils.login()}),$(".modal-close").on("click",function(o){o.preventDefault(),$("#fb-auth").removeClass("visible")}),$(".modal-container").on("click",function(){$("#fb-auth").removeClass("visible")}),$(".modal-content").on("click",function(o){o.stopPropagation()})},auth:function(){var o=$("#fb-auth");o.addClass("visible")}}}};window.SHIPFAMFINDER=o}(jQuery),function(o,t){window.addEventListener("load",function(){t.attach(document.body),o.init()},!1)}(SHIPFAMFINDER,FastClick);
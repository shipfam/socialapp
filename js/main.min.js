!function($){var t={init:function(){this.facebook.init(),this.nav.init(),this.cpanel.init(),this.ship.init()},opts:{date:"jan",fbresponse:null},facebook:{init:function(){var t=this;this.load(function(){FB.init(t.config)})},config:{appId:439670099504894,cookie:!0,status:!0,xfbml:!0,version:"v2.1"},load:function(t){if("function"!=typeof t)return void console.error("FB.load callback MUST be a function");var o,n=document.getElementsByTagName("script")[0];return document.getElementById("facebook-jssdk")?void console.warn("FBSDK already loaded"):(o=document.createElement("script"),o.id="facebook-jssdk",o.src="//connect.facebook.net/en_US/sdk.js",o.addEventListener("load",function(){t()},!1),void n.parentNode.insertBefore(o,n))},utils:{login:function(){var o=this;null===t.opts.fbresponse&&FB.login(function(){o.checkLoginState()},{scope:"public_profile"})},checkLoginState:function(){var t=this;FB.getLoginStatus(function(o){t.statusChangeCallback(o)})},getAcctInfo:function(t,o){var n={};return"function"!=typeof o?void console.warn("getAcctInfo callback needs to be a function"):void FB.api("/"+t,function(i){n.acct=i,FB.api("/"+t+"/picture",function(t){n.img=t.data,o(n)})})},statusChangeCallback:function(o){"connected"===o.status?this.getAcctInfo(o.authResponse.userID,function(o){t.opts.fbresponse=o,$(".fb-login").addClass("logged-in")}):$(".fb-login").removeClass("not_authorized"===o.status?"logged-in":"logged-in")}}},nav:{init:function(){this.hash(),this.events()},hash:function(){var t=window.location.hash,o,n;return t&&(o=t.replace("!",""),n=$(o),$(".visible-deck").removeClass("visible-deck"),n.addClass("visible-deck")),!1},events:function(){var t=this;window.addEventListener("hashchange",function(){t.hash()},!1)}},cpanel:{init:function(){}},ship:{init:function(){this.occupants.init()},occupants:{init:function(){this.events()},post:function(t){var o=this;$.post("/app/occupy",t).done(function(){o.get(t)}).fail(function(t){console.error("[POST Failure] - app.ship.occupants.post();"),console.log(t)})},get:function(o){var n=this;$.get("/app/occupy",o).done(function(o){if("null"!==o){$(".occupants").empty(),o=JSON.parse(o);for(var i=0;i<o.length;i++){var e=o[i].fbuser;t.facebook.utils.getAcctInfo(e,n.constructors.occupant)}}}).fail(function(t){console.error("[GET Failure] - app.ship.occupants.get();"),console.log(t)})},constructors:{occupant:function(t){var o="<div id='occupant-"+t.acct.id+"' class='occupant'><div class='profile-pic'><img src='"+t.img.url+"' alt='"+t.acct.name+"' /></div><div class='profile-info'><span class='name'>"+t.acct.name+"</span><a href='https://www.facebook.com/"+t.acct.id+"' title='View profile' target='_blank'>View Profile</a></div></div>";$(".occupants").append(o)}},events:function(){var o=this;$(".room-container").on("click",function(){var n=$(this),i=n.data("room"),e=n.data("deck"),c="<div class='popup' title=''><div class='title'><span class='left' title='Deck: "+e+", Room: "+i+"'>L"+e+"-R"+i+"</span><span class='right close-popup' title='Close'>&times;</span></div><div class='occupants no-occupants'>No occupants</div><div class='signup'><a href='#' class='occupy' data-room='"+i+"' data-deck='"+e+"'>Occupy this room</a></div></div>",a={room:i,deck:e,date:t.opts.date};$(".popup").remove(),$(".active-room").removeClass("active-room"),n.addClass("active-room"),n.append(c),o.get(a),$(".popup").on("click",function(){return!1}),$(".close-popup").on("click",function(){return $(".popup").remove(),$(".active-room").removeClass("active-room"),!1}),$(".occupy").on("click",function(){var n=$(this),i;return t.opts.fbresponse?(i={room:n.data("room"),deck:n.data("deck"),user:t.opts.fbresponse,date:t.opts.date},o.post(i)):o.auth(),!1})}),$("input[name=select-date]").on("change",function(){var o=$(this).val();t.opts.date=o}),$(".fb-login").on("click",function(o){o.preventDefault(),t.facebook.utils.login()}),$(".modal-close").on("click",function(t){t.preventDefault(),$("#fb-auth").removeClass("visible")}),$(".modal-container").on("click",function(){$("#fb-auth").removeClass("visible")}),$(".modal-content").on("click",function(t){t.stopPropagation()})},auth:function(){var t=$("#fb-auth");t.addClass("visible")}}}};window.SHIPFAMFINDER=t}(jQuery),function(t,o){window.addEventListener("load",function(){o.attach(document.body),t.init()},!1)}(SHIPFAMFINDER,FastClick);